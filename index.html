<html lang="en">
<head>
    <title>Song Patterns | Editor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css"/>
    <script src="https://kit.fontawesome.com/9d84495d6e.js" crossorigin="anonymous"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
</head>
<body class="dark-bg padding-std font-sans">
<header>
    <div class="header-elements gutter">
        <h1><a href="index.html"><img class="logo" src="images/logo.png" alt="Song Patterns"/></a></h1>
        <div id="login-options">
            <div id="firebaseui-auth-container"></div>
            <div id="user-logo"></div>
        </div>
    </div>
</header>

<main id="ui-container" class="pitch-selected gutter">
    <p class="abc-notation-panel"></p>

    <div id="playback-buttons" class="button-row row-full">
        <button id="btn-play"><i class="fa-solid fa-play"></i></button>
        <button id="btn-stop"><i class="fa-solid fa-square"></i></button>
    </div>

    <section class="menu">
        <div class="button-row row-halves">
            <button id="btn-index"><i class="fa-solid fa-list"></i></button>
            <button id="btn-save"><i class="fa-solid fa-floppy-disk"></i></button>
        </div>

        <div class="spotify-controls button-row row-fifths hidden-until-player-loaded">
            <button id="seekBackward15">-15</button>
            <button id="seekBackward3">-3</button>
            <button id="togglePlay">Play</button>
            <button id="seekForward3">+3</button>
            <button id="seekForward15">+15</button>
        </div>

        <div class="spotify-controls hidden-until-player-loaded">
            <div class="spotify-track-playing-container">
                <img id="spotify-art" alt="Art of currently playing track." />
                <p id="spotify-track-playing">[Polling for current track...]</p>
            </div>
        </div>

        <div id="spotify-transfer-container" class="spotify-transfer spotify-control button-row row-full">
            <button id="btn-spotify-transfer">Transfer Spotify control</button>
        </div>

        <div id="spotify-connect-container" class="spotify-connect spotify-control button-row row-full">
            <button id="btn-spotify-token">Get new Spotify token</button>
        </div>
    </section>

    <div class="tab-container">
        <div class="gutter">
            <div class="button-row row-quarters">
                <button id="btn-select-pitch">Pitch</button>
                <button id="btn-select-rhythm">Rhythm</button>
                <button id="btn-select-metadata">Metadata</button>
                <button id="btn-select-songs">Songs</button>
                <!--<button id="btn-select-debug">Debug</button>-->
            </div>
            <div class="tabs">
                <div id="scale-degree-inputs" class="tab pitch-tab">
                    <div class="key-input-container">
                        <label for="abc-metadata-key">Key</label>
                        <select id="abc-metadata-key">
                            <option value="C">C</option>
                            <option value="Db">C#/Db</option>
                            <option value="D">D</option>
                            <option value="Eb">D#/Eb</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                            <option value="F#">F#/Gb</option>
                            <option value="G">G</option>
                            <option value="Ab">G#/Ab</option>
                            <option value="A">A</option>
                            <option value="Bb">A#/Bb</option>
                            <option value="B">B</option>
                        </select>
                    </div>

                    <div class="button-row">
                        <button class="btn-scale-degree" id="btn-scale-degree-1-down">1</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b2-down">b2</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-2-down">2</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b3-down">b3</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-3-down">3</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-4-down">4</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b5-down">b5</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-5-down">5</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b6-down">b6</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-6-down">6</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b7-down">b7</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-7-down">7</button>
                    </div>

                    <div class="button-row">
                        <button class="btn-scale-degree" id="btn-scale-degree-1">1</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b2">b2</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-2">2</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b3">b3</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-3">3</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-4">4</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b5">b5</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-5">5</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b6">b6</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-6">6</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b7">b7</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-7">7</button>
                    </div>

                    <div class="button-row">
                        <button class="btn-scale-degree" id="btn-scale-degree-1-up">1</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b2-up">b2</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-2-up">2</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b3-up">b3</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-3-up">3</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-4-up">4</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b5-up">b5</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-5-up">5</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b6-up">b6</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-6-up">6</button>
                        <button class="btn-accidental btn-scale-degree" id="btn-scale-degree-b7-up">b7</button>
                        <button class="btn-scale-degree" id="btn-scale-degree-7-up">7</button>
                    </div>

                    <div class="button-row row-thirds">
                        <button id="btn-backspace"><i class="fa-solid fa-delete-left"></i></button>
                        <button id="btn-scale-degree-0">Rest</button>
                        <button class="btn-octave" id="btn-toggle-accidentals">#/b</button>
                    </div>
                </div>

                <div class="tab rhythm-tab">
                    <div class="row-halves">
                        <button id="btn-rhythm-prev">&lt;</button>
                        <button id="btn-rhythm-next">&gt;</button>
                    </div>
                    <div class="row-thirds">
                        <button id="btn-pickup">Pickup</button>
                        <button id="btn-tie">Tie</button>
                        <button id="btn-dot">Dot</button>
                    </div>
                    <div class="row-quarters row-duration">
                        <button id="btn-whole"><img src="images/whole.png" alt="Whole note"/></button>
                        <button id="btn-half"><img src="images/half.png" alt="Half note"/></button>
                        <button id="btn-quarter"><img src="images/quarter.png" alt="Quarter note"/></button>
                        <button id="btn-eighth"><img src="images/eighth.png" alt="Eighth note"/></button>
                    </div>
                    <div class="row-quarters row-duration">
                        <button id="btn-sixteenth"><img src="images/sixteenth.png" alt="Sixteenth note"/></button>
                        <button id="btn-thirty-second"><img src="images/thirtysecond.png" alt="Thirty-second note"/>
                        </button>
                        <button id="btn-q-triplets"><img src="images/quarter3.png" alt="Quarter note triplets"/>
                        </button>
                        <button id="btn-e-triplets"><img src="images/eighth3.png" alt="Eighth note triplets"/></button>
                    </div>
                </div>

                <div class="tab metadata-tab">
                    <section id="metadata">
                        <div class="control-group-octave">
                            <label for="abc-metadata-octave">Octave</label>
                            <button class="btn-octave" id="btn-octave-down">-</button>
                            <span id="abc-metadata-octave">1</span>
                            <button class="btn-octave" id="btn-octave-up">+</button>
                        </div>

                        <input type="checkbox" id="swung" name="swung"/>
                        <label for="swung">Swung</label>
                        <br/>

                        <input type="checkbox" id="insert-mode" name="insert-mode"/>
                        <label for="insert-mode">Insert mode</label>
                        <br/>

                        <label for="abc-metadata-output-swing-subdivisions">Swing subdivision</label>
                        <span id="abc-metadata-output-swing-subdivisions">16n</span>
                        <button class="btn-octave" id="btn-toggle-subdivision">8/16</button>
                        <br/>

                        <div id="time-sig-buttons" class="button-row row-thirds selected-4-4">
                            <button id="btn-time-sig-4-4">4/4</button>
                            <button id="btn-time-sig-6-8">6/8</button>
                            <button id="btn-time-sig-12-8">12/8</button>
                        </div>

                        <form id="metadata-text-inputs">
                            <label for="bpm">BPM</label><input type="number" name="bpm" id="bpm"/><br/>
                            <button id="btn-tap-tempo">Tempo Tap</button>
                            <label for="song-title">Title</label><input type="text" name="song-title"
                                                                        id="song-title"/><br/>
                            <label for="song-artist">Artist</label><input type="text" name="song-artist"
                                                                          id="song-artist"/><br/>
                            <label for="song-section">Section</label><input type="text" name="song-section"
                                                                            id="song-section"/>
                        </form>
                    </section>
                </div>

                <div class="tab songs-tab">
                    <div id="songs-container"></div>
                </div>

                <div class="tab debug-tab">
                    <p id="debug-panel"></p>
                </div>
            </div>
        </div>
    </div>
</main>

<div id="loading-circle"><img src="loading.gif" alt="Loading..."/></div>

<script>
    function gapiLoaded() {
        gapi.load('client', function () {
            gapi.client.init({
                apiKey: 'AIzaSyBJ4niYNhHDOLMFw-HT4y6vtoDHwm-r5DI',
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(() => {
                gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: '1o8sUVbWFUNOwnGn9si_QhHQOrx_VyXymN549TlEYuD0',
                    range: 'A1:G1000',
                }).then((response) => {
                    const range = response.result;
                    if (!range || !range.values || range.values.length === 0) {
                        console.log('no values found');
                        return;
                    }

                    const currentUrl = window.location.href;
                    const queryString = currentUrl.split('?')[1];
                    const params = new URLSearchParams(queryString);
                    const artists = SpreadsheetParser.parse(range.values);
                    SpreadsheetParser.filterAndPopulateFromDb(artists, params.get('sh') === 'true').then((artists) => {
                        window.dispatchEvent(new CustomEvent('gotCatalogue', {
                            detail: {
                                artists: artists
                            },
                        }));
                    });
                });
            });
        });
    }
</script>

<script src="bundle.js"></script>
<script src="spotify.js"></script>
<script src="https://sdk.scdn.co/spotify-player.js"></script>
<script src="parser.js"></script>
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>

</body>
</html>
