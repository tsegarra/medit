(()=>{"use strict";var e="spotify_token",o="pre_auth_querystring",t=document.getElementById("togglePlay"),n=document.getElementById("seekForward3"),r=document.getElementById("seekForward15"),a=document.getElementById("seekBackward3"),c=document.getElementById("seekBackward15"),i=document.getElementsByClassName("hidden-until-player-loaded"),l=(document.getElementById("debug-panel"),document.getElementById("btn-spotify-token")),s=document.getElementById("btn-spotify-transfer"),d=document.getElementById("spotify-transfer-container"),u=document.getElementById("spotify-connect-container"),g=document.getElementById("spotify-track-playing");function y(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.track_window.current_track;g.textContent=n.name+" - "+n.artists[0].name;var r=o?!e.paused:e.paused;r?(t.textContent="Play",t.classList.remove("spotify-playing")):(t.textContent="Pause",t.classList.add("spotify-playing"))}function f(e){e.getCurrentState().then((function(o){o?y(o):window.setTimeout((function(){return f(e)}),500)}))}function m(l){console.log("connecting to spotify...");var g=new Spotify.Player({name:"Web Playback SDK Quick Start Player",getOAuthToken:function(e){e(l)},volume:.5});g.addListener("ready",(function(t){var n=t.device_id;console.log("player is ready"),localStorage.setItem(e,l),localStorage.setItem("spotify_device_id",n),console.log("Ready with Device ID",n),s.onclick=function(){return function(e,o,t){console.log("transferring to device...");var n={device_ids:[e],play:!1};console.log("body from transfer request response:"),fetch("https://api.spotify.com/v1/me/player",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o},body:JSON.stringify(n)}).then((function(e){console.log(e.body),d.classList.remove("ready"),Array.from(i).forEach((function(e){e.classList.remove("hidden-until-player-loaded")})),f(t)}))}(n,l,g)},d.classList.add("ready");var r=localStorage.getItem(o);r&&(localStorage.removeItem(o),window.location.search=r)})),g.addListener("not_ready",(function(e){var o=e.device_id;console.log("device id has gone offline"),console.log("Device ID has gone offline",o)})),g.addListener("initialization_error",(function(e){var o=e.message;console.log("init error"),console.error(o),console.log("initialization error:"),console.log(o)})),g.addListener("authentication_error",(function(e){var o=e.message;u.classList.add("ready"),console.log("auth_error"),console.error(o),console.log("authentication error:"),console.log(o)})),g.addListener("account_error",(function(e){var o=e.message;console.log("account_error"),console.error(o),console.log("account error:"),console.log(o)})),n.onclick=function(){p(g,3)},r.onclick=function(){p(g,15)},a.onclick=function(){p(g,-3)},c.onclick=function(){p(g,-15)},t.onclick=function(){console.log("toggle play"),g.togglePlay().then((function(){g.getCurrentState().then((function(e){e?y(e,!0):console.error("No state returned.")}))}))},g.connect().then()}function p(e,o){e.getCurrentState().then((function(t){t?e.seek(t.position+1e3*o).then((function(){return console.log("sought")})):alert("Set your device in Spotify to the SDK.")}))}window.onSpotifyWebPlaybackSDKReady=function(){var o=localStorage.getItem(e),t=window.location.href.split("#")[1],n=new URLSearchParams(t).get("access_token");n?(console.log("has token from querystring"),history.pushState(null,"",location.href.split("#")[0]),m(n)):o?(console.log("no token in querystring; has token in local storage"),m(o)):(console.log("no token in querystring or localstorage"),u.classList.add("ready"))},l.onclick=function(){console.log("getting new token...");var e=encodeURIComponent("http://localhost:8081");localStorage.setItem(o,window.location.search),window.location.href="https://accounts.spotify.com/authorize?response_type=token&client_id=3c969ca08c62441186e99afc7ba69477&scope=streaming+user-read-email+user-modify-playback-state+user-read-private&redirect_uri="+e+"&state=075a4495-70d1-4862-be93-71c0ce1d845d"}})();