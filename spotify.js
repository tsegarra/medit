(()=>{"use strict";var e="spotify_token",t="pre_auth_querystring",n=document.getElementById("togglePlay"),o=document.getElementById("seekForward3"),r=document.getElementById("seekForward15"),i=document.getElementById("seekBackward3"),a=document.getElementById("seekBackward15"),c=document.getElementsByClassName("hidden-until-player-loaded"),s=document.getElementById("btn-spotify-token"),l=document.getElementById("btn-spotify-transfer"),d=document.getElementById("spotify-transfer-container"),u=document.getElementById("spotify-connect-container"),g=document.getElementById("spotify-track-playing"),m=document.getElementById("spotify-art");function f(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=e.track_window.current_track,r=e.track_window.current_track.album.images;r.length>0&&(m.src=r[0].url,m.classList.add("shown")),g.textContent=o.name+" - "+o.artists[0].name;var i=t?!e.paused:e.paused;i?(n.textContent="Play",n.classList.remove("spotify-playing")):(n.textContent="Pause",n.classList.add("spotify-playing"))}function h(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.getCurrentState().then((function(n){n?f(n,t):window.setTimeout((function(){return h(e)}),500)}))}function y(s){console.log("connecting to spotify...");var g=new Spotify.Player({name:"Web Playback SDK Quick Start Player",getOAuthToken:function(e){e(s)},volume:.5});g.addListener("ready",(function(n){var o=n.device_id;console.log("player is ready"),localStorage.setItem(e,s),localStorage.setItem("spotify_device_id",o),console.log("Ready with Device ID",o),l.onclick=function(){!function(e,t,n){console.log("transferring to device..."),fetch("https://api.spotify.com/v1/me/player",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t},body:JSON.stringify({device_ids:[e],play:!1})}).then((function(){d.classList.remove("ready"),Array.from(c).forEach((function(e){e.classList.remove("hidden-until-player-loaded")})),h(n)}))}(o,s,g)},d.classList.add("ready");var r=localStorage.getItem(t);r&&(localStorage.removeItem(t),window.location.search=r),window.addEventListener("newSongSelected",(function(e){var t=e.detail;(function(e,t,n){return fetch("https://api.spotify.com/v1/search?q="+encodeURIComponent(n)+"&type=track",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}}).then((function(e){return e.json().then((function(e){return e.tracks.items}))}))})(s,0,[t.song,t.artist].join(" ")).then((function(e){var t=document.getElementById("songs-container"),n=document.getElementById("search-results-container"),r=document.getElementById("search-results");r.innerHTML="",e.map((function(e){var t=document.createElement("div"),n=e.album.images;if(n.length>0){var r=document.createElement("img");r.src=n[0].url,t.appendChild(r)}var i=document.createElement("div");return i.textContent=e.name+" - "+e.artists.map((function(e){return e.name})).join(", "),t.appendChild(i),t.onclick=function(){(function(e,t,n){return fetch("https://api.spotify.com/v1/me/player/queue?uri="+encodeURIComponent(e)+"&device_id="+t,{method:"POST",headers:{Authorization:"Bearer "+n}})})(e.uri,o,s).then((function(){(function(e){return fetch("https://api.spotify.com/v1/me/player/next",{method:"POST",headers:{Authorization:"Bearer "+e}})})(s).then((function(){return h(g,!0)}))}))},t})).forEach((function(e){r.appendChild(e)})),t.classList.add("hidden"),n.classList.remove("hidden")}))}))})),g.addListener("not_ready",(function(e){var t=e.device_id;console.log("device id has gone offline"),console.log("Device ID has gone offline",t)})),g.addListener("initialization_error",(function(e){var t=e.message;console.log("init error"),console.error(t),console.log("initialization error:"),console.log(t)})),g.addListener("authentication_error",(function(e){var t=e.message;u.classList.add("ready"),console.log("auth_error"),console.error(t),console.log("authentication error:"),console.log(t)})),g.addListener("account_error",(function(e){var t=e.message;console.log("account_error"),console.error(t),console.log("account error:"),console.log(t)})),o.onclick=function(){p(g,3)},r.onclick=function(){p(g,15)},i.onclick=function(){p(g,-3)},a.onclick=function(){p(g,-15)},n.onclick=function(){console.log("toggle play"),g.togglePlay().then((function(){g.getCurrentState().then((function(e){e?f(e,!0):console.error("No state returned.")}))}))},g.connect().then()}function p(e,t){e.getCurrentState().then((function(n){n?e.seek(n.position+1e3*t).then((function(){return console.log("sought")})):alert("Set your device in Spotify to the SDK.")}))}window.onSpotifyWebPlaybackSDKReady=function(){var t=localStorage.getItem(e),n=window.location.href.split("#")[1],o=new URLSearchParams(n).get("access_token");o?(console.log("has token from querystring"),history.pushState(null,"",location.href.split("#")[0]),y(o)):t?(console.log("no token in querystring; has token in local storage"),y(t)):(console.log("no token in querystring or localstorage"),u.classList.add("ready"))},s.onclick=function(){console.log("getting new token...");var e=window.location.href.indexOf("localhost")>-1?"http://localhost:8081":"https://tsegarra.github.io/medit",n=encodeURIComponent(e);localStorage.setItem(t,window.location.search),window.location.href="https://accounts.spotify.com/authorize?response_type=token&client_id=3c969ca08c62441186e99afc7ba69477&scope=streaming+user-read-email+user-modify-playback-state+user-read-private&redirect_uri="+n+"&state=075a4495-70d1-4862-be93-71c0ce1d845d"}})();