(()=>{"use strict";var e="spotify_token",o=document.getElementById("togglePlay"),t=document.getElementById("seekForward3"),n=document.getElementById("seekForward15"),r=document.getElementById("seekBackward3"),c=document.getElementById("seekBackward15"),i=document.getElementsByClassName("hidden-until-player-loaded"),a=(document.getElementById("debug-panel"),document.getElementById("btn-spotify-token")),s=document.getElementById("btn-spotify-transfer"),l=document.getElementById("spotify-transfer-container"),d=document.getElementById("spotify-connect-container"),u=document.getElementById("spotify-track-playing");function g(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.track_window.current_track;u.textContent=n.name+" - "+n.artists[0].name;var r=t?!e.paused:e.paused;r?(o.textContent="Play",o.classList.remove("spotify-playing")):(o.textContent="Pause",o.classList.add("spotify-playing"))}function y(e){e.getCurrentState().then((function(o){o?g(o):window.setTimeout((function(){return y(e)}),500)}))}function f(a){console.log("connecting to spotify...");var d=new Spotify.Player({name:"Web Playback SDK Quick Start Player",getOAuthToken:function(e){e(a)},volume:.5});d.addListener("ready",(function(o){var t=o.device_id;console.log("player is ready"),localStorage.setItem(e,a),localStorage.setItem("spotify_device_id",t),console.log("Ready with Device ID",t),s.onclick=function(){return function(e,o,t){console.log("transferring to device...");var n={device_ids:[e],play:!1};console.log("body from transfer request response:"),fetch("https://api.spotify.com/v1/me/player",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o},body:JSON.stringify(n)}).then((function(e){console.log(e.body),l.classList.remove("ready"),Array.from(i).forEach((function(e){e.classList.remove("hidden-until-player-loaded")})),y(t)}))}(t,a,d)},l.classList.add("ready")})),d.addListener("not_ready",(function(e){var o=e.device_id;console.log("device id has gone offline"),console.log("Device ID has gone offline",o)})),d.addListener("initialization_error",(function(e){var o=e.message;console.log("init error"),console.error(o),console.log("initialization error:"),console.log(o)})),d.addListener("authentication_error",(function(e){var o=e.message;m(),console.log("auth_error"),console.error(o),console.log("authentication error:"),console.log(o)})),d.addListener("account_error",(function(e){var o=e.message;console.log("account_error"),console.error(o),console.log("account error:"),console.log(o)})),t.onclick=function(){p(d,3)},n.onclick=function(){p(d,15)},r.onclick=function(){p(d,-3)},c.onclick=function(){p(d,-15)},o.onclick=function(){console.log("toggle play"),d.togglePlay().then((function(){d.getCurrentState().then((function(e){e?g(e,!0):console.error("No state returned.")}))}))},d.connect()}function m(){console.log("getting new token...");var e=encodeURIComponent("https://tsegarra.github.io/medit");window.location.href="https://accounts.spotify.com/authorize?response_type=token&client_id=3c969ca08c62441186e99afc7ba69477&scope=streaming+user-read-email+user-modify-playback-state+user-read-private&redirect_uri="+e+"&state=075a4495-70d1-4862-be93-71c0ce1d845d"}function p(e,o){e.getCurrentState().then((function(t){t?e.seek(t.position+1e3*o).then((function(){return console.log("sought")})):alert("Set your device in Spotify to the SDK.")}))}window.onSpotifyWebPlaybackSDKReady=function(){var o=localStorage.getItem(e),t=window.location.href.split("#")[1],n=new URLSearchParams(t).get("access_token");n?(console.log("has token from querystring"),history.pushState(null,"",location.href.split("#")[0]),f(n)):o?(console.log("no token in querystring; has token in local storage"),f(o)):(console.log("no token in querystring or localstorage"),d.classList.add("ready"))},a.onclick=m})();